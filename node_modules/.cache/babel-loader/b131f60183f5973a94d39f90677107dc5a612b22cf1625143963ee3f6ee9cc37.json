{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useParams,useNavigate}from\"react-router-dom\";import{useQuery,useMutation}from\"@apollo/client\";import{Container,Row,Col,Card,Button,Alert,Form}from\"react-bootstrap\";import{GET_ITEMS_FOR_SWAP}from\"../utils/queries\";import{UPDATE_ITEM_STATUS}from\"../utils/mutations\";import Auth from\"../utils/auth\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const AcceptSwapItems=()=>{const{itemToChange}=useParams();const navigate=useNavigate();const{loading,data,error}=useQuery(GET_ITEMS_FOR_SWAP,{variables:{itemToChange}});const[updateItemStatus]=useMutation(UPDATE_ITEM_STATUS);const[items,setItems]=useState([]);const[feedback,setFeedback]=useState(\"\");// New state for feedback\nconst[message,setMessage]=useState(\"\");const[isProcessing,setIsProcessing]=useState(false);useEffect(()=>{if(!loading&&data){const filteredItems=data.itemsForSwap.filter(item=>item.itemStatus===\"OfferToSwap\");setItems(filteredItems);}},[loading,data]);const handleAcceptSwap=async(acceptedItemId,requestedByUser,offeredItems)=>{setIsProcessing(true);try{// Get the current user's username\nconst currentUser=Auth.getProfile().data.username;// Update the status and ownership of the \"requestToSwap\" item\nawait updateItemStatus({variables:{itemId:itemToChange,status:\"Accepted\",//   newOwner: currentUser, // Update to requestByUser value\nnewOwner:'test3'}});// Update the status and ownership of the \"OfferToSwap\" items\nitems.filter(item=>item.itemStatus===\"OfferToSwap\").forEach(async offeredItem=>{await updateItemStatus({variables:{itemId:offeredItem.id,status:\"Swapped\",//   newOwner: offeredItem.offerToUser, // Update to offerToUser value\nnewOwner:'test'}});});setMessage(\"Swap accepted successfully.\");navigate(\"/created\");}catch(error){console.error(\"Error during swap:\",error);setMessage(\"Failed to complete swap.\");}finally{setIsProcessing(false);}};// New function to handle navigation to the home page\nconst handleCancel=()=>{navigate(\"/\");// Navigates to the home page\n};if(loading)return/*#__PURE__*/_jsx(\"h1\",{children:\"Loading...\"});if(error)return/*#__PURE__*/_jsxs(Alert,{variant:\"danger\",children:[\"Error loading items: \",error.message]});return/*#__PURE__*/_jsxs(Container,{children:[message&&/*#__PURE__*/_jsx(Alert,{variant:message.includes(\"Failed\")?\"danger\":\"success\",children:message}),/*#__PURE__*/_jsx(Row,{children:items.map(item=>/*#__PURE__*/_jsx(Col,{xs:12,md:6,lg:4,children:/*#__PURE__*/_jsxs(Card,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Card.Img,{variant:\"top\",src:item.image,alt:item.itemName}),/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(Card.Title,{children:item.itemName}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"feedback\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Feedback\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Enter your feedback\",value:feedback,onChange:e=>setFeedback(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between mt-3\",children:[/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:()=>handleAcceptSwap(item.id,item.requestByUser,items.map(itm=>itm.id)),disabled:isProcessing,children:\"Accept Swap\"}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleCancel,children:\"Cancel\"})]})]})]})},item.id))})]});};export default AcceptSwapItems;","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","useQuery","useMutation","Container","Row","Col","Card","Button","Alert","Form","GET_ITEMS_FOR_SWAP","UPDATE_ITEM_STATUS","Auth","jsx","_jsx","jsxs","_jsxs","AcceptSwapItems","itemToChange","navigate","loading","data","error","variables","updateItemStatus","items","setItems","feedback","setFeedback","message","setMessage","isProcessing","setIsProcessing","filteredItems","itemsForSwap","filter","item","itemStatus","handleAcceptSwap","acceptedItemId","requestedByUser","offeredItems","currentUser","getProfile","username","itemId","status","newOwner","forEach","offeredItem","id","console","handleCancel","children","variant","includes","map","xs","md","lg","className","Img","src","image","alt","itemName","Body","Title","Group","controlId","Label","Control","type","placeholder","value","onChange","e","target","onClick","requestByUser","itm","disabled"],"sources":["/Users/phoenix/code/vercel/swapcommf/src/pages/AcceptSwapItems.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useQuery, useMutation } from \"@apollo/client\";\nimport { Container, Row, Col, Card, Button, Alert, Form } from \"react-bootstrap\";\nimport { GET_ITEMS_FOR_SWAP } from \"../utils/queries\";\nimport { UPDATE_ITEM_STATUS } from \"../utils/mutations\";\nimport Auth from \"../utils/auth\";\n\nconst AcceptSwapItems = () => {\n  const { itemToChange } = useParams();\n  const navigate = useNavigate();\n  const { loading, data, error } = useQuery(GET_ITEMS_FOR_SWAP, {\n    variables: { itemToChange },\n  });\n\n  const [updateItemStatus] = useMutation(UPDATE_ITEM_STATUS);\n  const [items, setItems] = useState([]);\n  const [feedback, setFeedback] = useState(\"\"); // New state for feedback\n  const [message, setMessage] = useState(\"\");\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  useEffect(() => {\n    if (!loading && data) {\n      const filteredItems = data.itemsForSwap.filter(\n        (item) => item.itemStatus === \"OfferToSwap\"\n      );\n      setItems(filteredItems);\n    }\n  }, [loading, data]);\n\n  const handleAcceptSwap = async (\n    acceptedItemId,\n    requestedByUser,\n    offeredItems\n  ) => {\n    setIsProcessing(true);\n    try {\n     // Get the current user's username\n     const currentUser = Auth.getProfile().data.username;\n\n     // Update the status and ownership of the \"requestToSwap\" item\n     await updateItemStatus({\n       variables: {\n         itemId: itemToChange,\n         status: \"Accepted\",\n       //   newOwner: currentUser, // Update to requestByUser value\n       newOwner: 'test3'\n       },\n     });\n\n     // Update the status and ownership of the \"OfferToSwap\" items\n     items\n       .filter((item) => item.itemStatus === \"OfferToSwap\")\n       .forEach(async (offeredItem) => {\n         await updateItemStatus({\n           variables: {\n             itemId: offeredItem.id,\n             status: \"Swapped\",\n           //   newOwner: offeredItem.offerToUser, // Update to offerToUser value\n           newOwner: 'test'\n           },\n         });\n       });\n\n     setMessage(\"Swap accepted successfully.\");\n     navigate(\"/created\");\n   } catch (error) {\n     console.error(\"Error during swap:\", error);\n     setMessage(\"Failed to complete swap.\");\n   } finally {\n     setIsProcessing(false);\n   }\n };\n\n  // New function to handle navigation to the home page\n  const handleCancel = () => {\n    navigate(\"/\"); // Navigates to the home page\n  };\n\n  if (loading) return <h1>Loading...</h1>;\n  if (error)\n    return <Alert variant=\"danger\">Error loading items: {error.message}</Alert>;\n\n  return (\n    <Container>\n      {message && (\n        <Alert variant={message.includes(\"Failed\") ? \"danger\" : \"success\"}>\n          {message}\n        </Alert>\n      )}\n      <Row>\n        {items.map((item) => (\n          <Col key={item.id} xs={12} md={6} lg={4}>\n            <Card className=\"mb-3\">\n              <Card.Img variant=\"top\" src={item.image} alt={item.itemName} />\n              <Card.Body>\n                <Card.Title>{item.itemName}</Card.Title>\n                <Form.Group controlId=\"feedback\">\n                  <Form.Label>Feedback</Form.Label>\n                  <Form.Control\n                    type=\"text\"\n                    placeholder=\"Enter your feedback\"\n                    value={feedback}\n                    onChange={(e) => setFeedback(e.target.value)}\n                  />\n                </Form.Group>\n                <div className=\"d-flex justify-content-between mt-3\">\n                  <Button\n                    variant=\"success\"\n                    onClick={() =>\n                      handleAcceptSwap(\n                        item.id,\n                        item.requestByUser,\n                        items.map((itm) => itm.id)\n                      )\n                    }\n                    disabled={isProcessing}\n                  >\n                    Accept Swap\n                  </Button>\n                  <Button\n                    variant=\"secondary\"\n                    onClick={handleCancel}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </Card.Body>\n            </Card>\n          </Col>\n        ))}\n      </Row>\n    </Container>\n  );\n};\n\nexport default AcceptSwapItems;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}